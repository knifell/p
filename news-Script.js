// Объект с переводами статического контента
const translations = {
    "page-title": {
        "ru": "Новости - Кара-Гуз айыл аймагы",
        "kg": "Жаңылыктар - Кара-Гуз айыл аймагы"
    },
    "meta-description": {
        "ru": "Последние новости и объявления Кара-Гуз айыл аймагы.",
        "kg": "Кара-Гуз айыл аймагынын акыркы жаңылыктары жана жарыялары."
    },
    "meta-keywords": {
        "ru": "Кара-Гуз, новости, события, объявления",
        "kg": "Кара-Гуз, жаңылыктар, окуялар, жарыялар"
    },
    "nav-main": { "ru": "Главная", "kg": "Негизги бет" },
    "nav-about": { "ru": "О нас", "kg": "Биз жөнүндө" },
    "nav-news": { "ru": "Новости", "kg": "Жаңылыктар" },
    "nav-appeals": { "ru": "Обращения", "kg": "Кайрылуулар" },
    "nav-gallery": { "ru": "Галерея", "kg": "Галерея" },
    "nav-contacts": { "ru": "Контакты", "kg": "Байланыш" },
    "main-title": {
        "ru": "Последние новости",
        "kg": "Акыркы жаңылыктар"
    },
    "news-unavailable": {
        "ru": "Не удалось загрузить новости. Пожалуйста, попробуйте позже.",
        "kg": "Жаңылыктарды жүктөй алган жок. Сураныч, кийинчерээк кайра аракет кылыңыз."
    },
    "no-news": {
        "ru": "На данный момент новостей нет.",
        "kg": "Учурда жаңылыктар жок."
    },
    "read-more-btn": {
        "ru": "Подробнее",
        "kg": "Көбүрөөк окуу"
    },
    "back-to-news-btn": {
        "ru": "← Все новости",
        "kg": "← Бардык жаңылыктар"
    },
    "footer-copyright": {
        "ru": "&copy; 2025 Кара-Гуз айыл аймагы. Все права защищены.",
        "kg": "&copy; 2025 Кара-Гуз айыл аймагы. Бардык укуктар корголгон."
    }
};

// Функция для установки языка
function setLanguage(lang) {
    const elements = document.querySelectorAll('[data-translate]');
    elements.forEach(element => {
        const key = element.getAttribute('data-translate');
        if (translations[key] && translations[key][lang]) {
            element.textContent = translations[key][lang];
        }
    });

    // Обновление текста кнопок
    document.querySelectorAll('.read-more-btn').forEach(btn => {
        btn.textContent = translations["read-more-btn"][lang];
    });

    const backBtn = document.querySelector('.back-to-news-btn');
    if (backBtn) {
        backBtn.textContent = translations["back-to-news-btn"][lang];
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const newsListView = document.querySelector('.news-list-view');
    const newsFullView = document.querySelector('.news-full-view');
    let articles = []; // Массив для хранения данных новостей

    // Перевод статического контента по умолчанию
    setLanguage('ru');
    const langButtons = document.querySelectorAll('.lang-btn');
    langButtons.forEach(btn => {
        btn.addEventListener('click', (e) => {
            langButtons.forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            const lang = e.target.id.replace('lang-', '');
            setLanguage(lang);
        });
    });

    // Функция для загрузки и отображения списка новостей (использует встроенные данные)
    const fetchNews = async () => {
        // Данные новостей с переводами
        const newsData = [
            {
                "id": 1,
                "attributes": {
                    "title": {
                        "ru": "Ремонт дорог в селе Сары-Булак",
                        "kg": "Сары-Булак айылындагы жолдорду оңдоо"
                    },
                    "description": {
                        "ru": "В Кара-Гузском айыл аймаке начались работы по ремонту внутренних дорог в селе Сары-Булак. Жители выражают благодарность за инициативу.",
                        "kg": "Кара-Гуз айыл аймагында Сары-Булак айылынын ички жолдорун оңдоо иштери башталды. Жергиликтүү тургундар бул демилгеге ыраазычылык билдиришти."
                    },
                    "content": {
                        "ru": "В рамках программы развития инфраструктуры Кара-Гузского айыл аймака начался капитальный ремонт дорожного полотна на центральных улицах села Сары-Булак. Работы включают в себя укладку нового асфальта и установку бордюров. Ожидается, что ремонт завершится в течение месяца, что значительно улучшит транспортное сообщение и комфорт для жителей.",
                        "kg": "Кара-Гуз айыл аймагынын инфраструктурасын өнүктүрүү программасынын алкагында Сары-Булак айылынын борбордук көчөлөрүндөгү жолдорду капиталдык оңдоо башталды. Иштер жаңы асфальт төшөөнү жана бордюрларды орнотууну камтыйт. Оңдоо бир айдын ичинде бүтүп, тургундар үчүн транспорттук каттамды жана ыңгайлуулукту бир топ жакшыртат деп күтүлүүдө."
                    },
                    "date": "2025-08-14T00:00:00.000Z",
                    "image": {
                        "data": {
                            "attributes": {
                                "url": "images/road-repair.jpg"
                            }
                        }
                    }
                }
            },
            {
                "id": 2,
                "attributes": {
                    "title": {
                        "ru": "Встреча главы айыл аймака с молодежью",
                        "kg": "Айыл аймагынын башчысынын жаштар менен жолугушуусу"
                    },
                    "description": {
                        "ru": "Глава Кара-Гузского айыл аймака провёл встречу с активной молодежью для обсуждения проектов и инициатив.",
                        "kg": "Кара-Гуз айыл аймагынын башчысы долбоорлорду жана демилгелерди талкуулоо үчүн активдүү жаштар менен жолугушуу өткөрдү."
                    },
                    "content": {
                        "ru": "Сегодня в Доме культуры состоялась встреча главы айыл аймака с представителями молодежных организаций и студентами. Обсуждались вопросы трудоустройства, поддержки стартапов и участия молодежи в общественной жизни. Глава подчеркнул важность вклада нового поколения в развитие региона и пообещал всестороннюю поддержку.",
                        "kg": "Бүгүн Маданият үйүндө айыл аймагынын башчысы жаштар уюмдарынын өкүлдөрү жана студенттер менен жолугушту. Жумуш менен камсыз кылуу, стартаптарды колдоо жана жаштардын коомдук жашоого катышуу маселелери талкууланды. Башчы жаңы муундун аймакты өнүктүрүүгө кошкон салымынын маанилүүлүгүн белгилеп, ар тараптуу колдоо көрсөтүүгө убада берди."
                    },
                    "date": "2025-08-12T00:00:00.000Z",
                    "image": {
                        "data": {
                            "attributes": {
                                "url": "images/youth-meeting.jpg"
                            }
                        }
                    }
                }
            },
            {
                "id": 3,
                "attributes": {
                    "title": {
                        "ru": "Проведение субботника в селе Кара-Гуз",
                        "kg": "Кара-Гуз айылында ишембилик өткөрүү"
                    },
                    "description": {
                        "ru": "Жители села Кара-Гуз объединились для проведения масштабного субботника по благоустройству территории.",
                        "kg": "Кара-Гуз айылынын тургундары аймакты көрктөндүрүү боюнча масштабдуу ишембилик өткөрүү үчүн биригишти."
                    },
                    "content": {
                        "ru": "В минувшую субботу прошел общереспубликанский субботник. Жители села Кара-Гуз не остались в стороне и активно участвовали в уборке территории, высадке деревьев и покраске бордюров. Совместными усилиями удалось сделать село чище и уютнее. Мероприятие завершилось совместным обедом и дружеским общением.",
                        "kg": "Өткөн ишембиде жалпы республикалык ишембилик өттү. Кара-Гуз айылынын тургундары да четте калбай, аймакты тазалоого, бак-дарактарды отургузууга жана бордюрларды сырдоого активдүү катышты. Биргелешкен күч-аракет менен айылды таза жана жагымдуу кылууга мүмкүн болду. Иш-чара биргелешкен түшкү тамак жана достук баарлашуу менен аяктады."
                    },
                    "date": "2025-08-10T00:00:00.000Z",
                    "image": {
                        "data": {
                            "attributes": {
                                "url": "images/subbotnik.jpg"
                            }
                        }
                    }
                }
            },
            {
                "id": 4,
                "attributes": {
                    "title": {
                        "ru": "Открытие новой детской площадки",
                        "kg": "Жаңы балдар аянтчасынын ачылышы"
                    },
                    "description": {
                        "ru": "В селе Кара-Кочкор состоялось торжественное открытие современной детской площадки, построенной при поддержке местной администрации.",
                        "kg": "Кара-Кочкор айылында жергиликтүү администрациянын колдоосу менен курулган заманбап балдар аянтчасынын салтанаттуу ачылышы болду."
                    },
                    "content": {
                        "ru": "Мечта многих семей сбылась: в центре села Кара-Кочкор появилась новая детская площадка. Она оборудована качелями, горками, песочницей и безопасным покрытием. На церемонии открытия присутствовали глава айыл окмоту, местные жители и, конечно, главные виновники торжества — дети. Глава отметил, что это лишь первый шаг в благоустройстве общественных пространств для наших юных граждан.",
                        "kg": "Көптөгөн үй-бүлөлөрдүн кыялы орундалды: Кара-Кочкор айылынын борборунда жаңы балдар аянтчасы пайда болду. Ал селкинчектер, тайгалактар, кум аянтчасы жана коопсуз жабуу менен жабдылган. Ачылыш аземине айыл өкмөт башчысы, жергиликтүү тургундар жана, албетте, салтанаттын башкы каармандары - балдар катышты. Башчы бул биздин жаш жарандарыбыз үчүн коомдук жайларды көрктөндүрүүдөгү биринчи гана кадам экенин белгиледи."
                    },
                    "date": "2025-08-08T00:00:00.000Z",
                    "image": {
                        "data": {
                            "attributes": {
                                "url": "images/playground.jpg"
                            }
                        }
                    }
                }
            },
            {
                "id": 5,
                "attributes": {
                    "title": {
                        "ru": "Подготовка к новому учебному году",
                        "kg": "Жаңы окуу жылына даярдык"
                    },
                    "description": {
                        "ru": "Школы Кара-Гузского айыл аймака активно готовятся к началу нового учебного года. Проведены ремонтные работы и закуплены учебники.",
                        "kg": "Кара-Гуз айыл аймагындагы мектептер жаңы окуу жылынын башталышына активдүү даярданып жатышат. Оңдоо иштери жүргүзүлүп, окуу китептери сатылып алынды."
                    },
                    "content": {
                        "ru": "Во всех учебных заведениях айыл аймака завершены косметические и капитальные ремонтные работы: обновлены классы, спортивные залы и столовые. Также в полном объёме получены и распределены новые учебники. Образовательные учреждения готовы принять своих учеников 1 сентября, обеспечивая комфортные и безопасные условия для обучения.",
                        "kg": "Айыл аймагынын бардык билим берүү мекемелеринде косметикалык жана капиталдык оңдоо иштери аяктады: класстар, спорт залдар жана ашканалар жаңыланды. Ошондой эле жаңы окуу китептери толук көлөмдө алынып, бөлүштүрүлдү. Билим берүү мекемелери 1-сентябрда окуучуларды кабыл алууга даяр, алар окуу үчүн ыңгайлуу жана коопсуз шарттарды камсыз кылышат."
                    },
                    "date": "2025-08-06T00:00:00.000Z",
                    "image": {
                        "data": {
                            "attributes": {
                                "url": "images/school.jpg"
                            }
                        }
                    }
                }
            },
            {
                "id": 6,
                "attributes": {
                    "title": {
                        "ru": "Фестиваль «Кара-Гуз — земля традиций»",
                        "kg": "«Кара-Гуз — салттар жери» фестивалы"
                    },
                    "description": {
                        "ru": "В айыл аймаке состоялся красочный фестиваль, посвященный местным традициям и народному творчеству.",
                        "kg": "Айыл аймагында жергиликтүү салттарга жана элдик чыгармачылыкка арналган фестивал өткөрүлдү."
                    },
                    "content": {
                        "ru": "В течение двух дней жители и гости Кара-Гузского айыл аймака наслаждались выступлениями фольклорных коллективов, выставкой ремесленных изделий и дегустацией национальных блюд. Фестиваль собрал большое количество участников и стал ярким событием, способствующим сохранению и популяризации культурного наследия региона.",
                        "kg": "Эки күндүн ичинде Кара-Гуз айыл аймагынын тургундары жана коноктору фольклордук жамааттардын аткарууларынан, кол өнөрчүлүк буюмдардын көргөзмөсүнөн жана улуттук тамак-аштардын даамын татуудан ырахат алышты. Фестиваль көптөгөн катышуучуларды чогултуп, аймактын маданий мурасын сактоого жана жайылтууга өбөлгө түзгөн жаркын окуя болду."
                    },
                    "date": "2025-08-04T00:00:00.000Z",
                    "image": {
                        "data": {
                            "attributes": {
                                "url": "images/festival.jpg"
                            }
                        }
                    }
                }
            },
            {
                "id": 7,
                "attributes": {
                    "title": {
                        "ru": "Работы по очистке ирригационных каналов",
                        "kg": "Сугат каналдарын тазалоо иштери"
                    },
                    "description": {
                        "ru": "В рамках подготовки к осенне-зимнему периоду проводятся работы по очистке ирригационных систем и каналов.",
                        "kg": "Күз-кыш мезгилине даярдык көрүү алкагында сугат системаларын жана каналдарын тазалоо иштери жүргүзүлүүдө."
                    },
                    "content": {
                        "ru": "Для обеспечения бесперебойного водоснабжения и предотвращения подтоплений в осенний период, специалисты и жители айыл аймака проводят плановую очистку ирригационных каналов. Эти работы жизненно важны для сельского хозяйства и предотвращения паводков. Работа ведется по утвержденному графику.",
                        "kg": "Үзгүлтүксүз суу менен камсыз кылуу жана күзгү мезгилде суу ташкынын алдын алуу үчүн, адистер жана айыл аймагынын тургундары сугат каналдарын пландуу тазалоо иштерин жүргүзүп жатышат. Бул иштер айыл чарбасы жана суу ташкындарын алдын алуу үчүн өтө маанилүү. Иштер бекитилген график боюнча жүргүзүлүүдө."
                    },
                    "date": "2025-08-02T00:00:00.000Z",
                    "image": {
                        "data": {
                            "attributes": {
                                "url": "images/irrigation.jpg"
                            }
                        }
                    }
                }
            },
            {
                "id": 8,
                "attributes": {
                    "title": {
                        "ru": "Семинар для фермеров по новым технологиям",
                        "kg": "Фермерлер үчүн жаңы технологиялар боюнча семинар"
                    },
                    "description": {
                        "ru": "В айыл окмоту прошел обучающий семинар для местных фермеров, посвященный современным агротехнологиям.",
                        "kg": "Айыл өкмөтүндө жергиликтүү фермерлер үчүн заманбап агротехнологияларга арналган окутуу семинары өттү."
                    },
                    "content": {
                        "ru": "Семинар был организован совместно с Министерством сельского хозяйства. Эксперты рассказали о новых методах обработки почвы, выборе семян и использовании современных удобрений, которые могут значительно повысить урожайность. Фермеры активно участвовали в обсуждениях, задавали вопросы и делились опытом. Семинар стал полезной площадкой для обмена знаниями.",
                        "kg": "Семинар Айыл чарба министрлиги менен биргеликте уюштурулду. Эксперттер топуракты иштетүүнүн жаңы ыкмалары, уруктарды тандоо жана түшүмдүүлүктү бир топ жогорулата турган заманбап жер семирткичтерди колдонуу жөнүндө айтып беришти. Фермерлер талкууларга активдүү катышып, суроолорду берип, тажрыйбалары менен бөлүшүштү. Семинар билим алмашуу үчүн пайдалуу аянтча болду."
                    },
                    "date": "2025-07-30T00:00:00.000Z",
                    "image": {
                        "data": {
                            "attributes": {
                                "url": "images/farmers-seminar.jpg"
                            }
                        }
                    }
                }
            }
        ];

        articles = newsData; // Сохраняем данные в переменную articles
        displayNews(articles);
    };

    // Функция для отображения списка новостей
    const displayNews = (articles) => {
        newsListView.innerHTML = '';
        const currentLang = document.querySelector('.lang-btn.active').id.replace('lang-', '');

        if (articles && articles.length > 0) {
            const newsGrid = document.createElement('div');
            newsGrid.className = 'news-grid';

            articles.forEach(article => {
                const imageUrl = article.attributes.image?.data?.attributes?.url || 'images/placeholder-news.jpg';
                const newsItem = document.createElement('div');
                newsItem.className = 'news-item';
                newsItem.innerHTML = `
                    <img src="${imageUrl}" alt="${article.attributes.title[currentLang]}" loading="lazy" width="100%" height="200">
                    <div style="padding: 15px;">
                        <h3 class="news-title">${article.attributes.title[currentLang]}</h3>
                        <p class="news-date">${new Date(article.attributes.date).toLocaleDateString(currentLang === 'ru' ? 'ru-RU' : 'kg-KG')}</p>
                        <p>${article.attributes.description[currentLang]}</p>
                    </div>
                    <a href="#" class="read-more-btn" data-id="${article.id}">${translations["read-more-btn"][currentLang]}</a>
                `;
                newsGrid.appendChild(newsItem);
            });
            newsListView.appendChild(newsGrid);
        } else {
            newsListView.innerHTML = `<p>${translations["no-news"][currentLang]}</p>`;
        }
    };

    // Функция для отображения полной статьи
    const showFullArticle = (article) => {
        newsFullView.style.display = 'block';
        newsListView.style.display = 'none';
        const currentLang = document.querySelector('.lang-btn.active').id.replace('lang-', '');

        const imageUrl = article.attributes.image?.data?.attributes?.url || 'images/placeholder-news.jpg';
        newsFullView.innerHTML = `
            <div class="full-article">
                <button class="back-to-news-btn">${translations["back-to-news-btn"][currentLang]}</button>
                <h3>${article.attributes.title[currentLang]}</h3>
                <p class="news-date" style="text-align: center;">${new Date(article.attributes.date).toLocaleDateString(currentLang === 'ru' ? 'ru-RU' : 'kg-KG')}</p>
                <img src="${imageUrl}" alt="${article.attributes.title[currentLang]}" class="full-article-photo">
                <div class="full-article-content">
                    <p>${article.attributes.content[currentLang]}</p>
                </div>
            </div>
        `;
        document.querySelector('.back-to-news-btn').addEventListener('click', () => {
            newsFullView.style.display = 'none';
            newsListView.style.display = 'block';
            document.querySelector('.news-grid').style.display = 'grid';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    };

    // Обработка кликов по кнопке "Подробнее"
    newsListView.addEventListener('click', async (e) => {
        if (e.target.classList.contains('read-more-btn')) {
            e.preventDefault();
            const articleId = parseInt(e.target.dataset.id, 10);
            const article = articles.find(item => item.id === articleId);
            if (article) {
                showFullArticle(article);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
    });

    // Запускаем загрузку новостей при загрузке страницы
    fetchNews();
});